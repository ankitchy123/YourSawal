<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <title>Your Sawaal :: Sailendra Damaraju</title>
    <link rel="icon" href="images/logo.jpg" type="image/png" sizes="16x16">
    <link rel="stylesheet" href="/css/main.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/color.css">
    <link rel="stylesheet" href="/css/responsive.css">
</head>

<body>
    <div class="wavy-wraper">
        <div class="wavy">
            <span style="--i:1;">Y</span>
            <span style="--i:2;">o</span>
            <span style="--i:3;">u</span>
            <span style="--i:4;">r</span>
            <span style="--i:5;">S</span>
            <span style="--i:6;">a</span>
            <span style="--i:7;">w</span>
            <span style="--i:8;">a</span>
            <span style="--i:9;">a</span>
            <span style="--i:10;">l</span>
        </div>
    </div>
    <div class="theme-layout">

        <div class="topbar stick">
            <div class="logo">
                <a title="" href="#"><img height="100" src="/images/logo.jpeg" alt=""></a>
            </div>
            <div class="top-area">

                <div class="top-search">
                    <form method="post" class="">
                        <input type="text" placeholder="Search Questions, Groups etc" id="searchinput">
                        <button data-ripple id="search" onclick="handleSearch(event)"><i class="ti-search"></i></button>
                    </form>
                </div>
                <div class="page-name">
                    <span>Profile</span>
                </div>
                <ul class="setting-area">
                    <li><a href="#" title="Languages" data-ripple=""><i class="fa fa-globe"></i><em>EN</em></a>
                    </li>

                </ul>
                <div class="user-img">
                    <h5 id="name">
                    </h5>
                    <img src="/images/resources/company1.png" alt="">
                    <div class="user-setting">

                        <ul class="log-out">
                            <li><a href="/viewprofile" title=""><i class="ti-user"></i> view profile</a></li>
                            <li><a href="/editprofile" title=""><i class="ti-pencil-alt"></i>edit profile</a></li>

                            <li><a onclick="logOut()"><i class="ti-power-off"></i>log out</a></li>
                        </ul>
                    </div>
                </div>
            </div>

        </div><!-- topbar -->

        <div class="fixed-sidebar left">
            <div class="menu-left">
                <ul class="left-menu">

                    <li>
                        <a href="C:\Users\stack\Desktop\Your Sawaal\questions\questions.html" title="Questions"
                            data-toggle="tooltip" data-placement="right">
                            <i class="ti-magnet"></i>
                        </a>
                    </li>
                    <li>
                        <a href="C:\Users\stack\Desktop\Your Sawaal\groups\timeline.html" title="Groups"
                            data-toggle="tooltip" data-placement="right">
                            <i class="fa fa-users"></i>
                        </a>
                    </li>
                    <li>
                        <a href="C:\Users\stack\Desktop\Your Sawaal\questions\question-details.html" title="Answer"
                            data-toggle="tooltip" data-placement="right">
                            <i class="fa fa-forumbee"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div><!-- left sidebar menu -->

        <section>
            <div class="gap2 gray-bg">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="row merged20" id="page-contents">
                                <div class="user-profile">
                                    <figure>
                                        <div class="edit-pp">
                                            <label class="fileContainer">
                                                <i class="fa fa-camera"></i>
                                                <input type="file">
                                            </label>
                                        </div>
                                        <img src="/images/resources/profile-image.jpg" alt="">
                                        <ul class="profile-controls" id="follow">
                                        </ul>
                                    </figure>

                                    <div class="profile-section">
                                        <div class="row">
                                            <div class="col-lg-2 col-md-3">
                                                <div class="profile-author">
                                                    <div class="profile-author-thumb">
                                                        <img alt="author" src="/images/resources/channel.jpg">
                                                        <div class="edit-dp">
                                                            <label class="fileContainer">
                                                                <i class="fa fa-camera"></i>
                                                                <input type="file">
                                                            </label>
                                                        </div>
                                                    </div>

                                                    <div class="author-content">
                                                        <a class="h4 author-name" href="about.html" id="fname">
                                                        </a>
                                                        <div class="country" id="location">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-10 col-md-9">
                                                <ul class="profile-menu">
                                                    <li>
                                                        <a class="" href="/usertimeline">Timeline</a>
                                                    </li>
                                                    <li>
                                                        <a class="active" href="/viewprofile">About</a>
                                                    </li>
                                                    <li>
                                                        <a class="" href="/userfollowers.html">Followers</a>
                                                    </li>
                                                    <li>
                                                        <a class="" href="user-groups.html">Groups</a>
                                                    </li>


                                                </ul>
                                                <ol class="folw-detail">
                                                    <li><span>Posts</span><ins>101</ins></li>
                                                    <li><span>Followers</span><ins id="followers">
                                                        </ins></li>
                                                    <li><span>Following</span><ins id="following">
                                                        </ins></li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- user profile banner  -->
                                <div class="col-lg-4 col-md-4">
                                    <aside class="sidebar">
                                        <div class="central-meta stick-widget">
                                            <span class="create-post">Personal Info</span>
                                            <div class="personal-head">
                                                <span class="f-title"><i class="fa fa-user"></i> About:</span>
                                                <p id="about">
                                                </p>
                                                <span class="f-title"><i class="fa fa-birthday-cake"></i>
                                                    Birthday:</span>
                                                <p id="dob">
                                                </p>
                                                <span class="f-title"><i class="fa fa-envelope"></i> Email
                                                    Address:</span>
                                                <p id="email">
                                                </p>
                                                <span class="f-title"><i class="fa fa-male"></i> Gender:</span>
                                                <p id="gender">
                                                </p>
                                                <span class="f-title"><i class="fa fa-globe"></i> Country:</span>
                                                <p id="country">
                                                </p>
                                                <span class="f-title"><i class="fa fa-briefcase"></i> Occupation:</span>
                                                <p id="occupation">
                                                </p>
                                                <span class="f-title"><i class="fa fa-handshake-o"></i> Joined:</span>
                                                <p id="joined">
                                                </p>
                                            </div>
                                        </div>
                                    </aside>
                                </div>
                                <div class="col-lg-8 col-md-8">
                                    <div class="central-meta">
                                        <span class="create-post">General Info</span>
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <div class="gen-metabox">
                                                    <span><i class="fa fa-puzzle-piece"></i>Hobbies</span>
                                                    <p id="hobbies">
                                                    </p>
                                                </div>
                                                <div class="gen-metabox">
                                                    <span><i class="fa fa-plus"></i> Interests</span>
                                                    <p id="interests">
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="gen-metabox">
                                                    <span><i class="fa fa-mortar-board"></i> Education</span>
                                                    <p id="education">
                                                    </p>
                                                </div>
                                                <div class="gen-metabox">
                                                    <span><i class="fa fa-certificate"></i> Work and experience</span>
                                                    <p id="workExperience">
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="gen-metabox no-margin">
                                                    <span><i class="fa fa-sitemap"></i> Social Networks</span>
                                                    <ul class="sociaz-media" id="socialmedia">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section><!-- content -->

        <div class="bottombar">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <span class="copyright">© Your Sawaal 2022. All rights reserved.</span>

                    </div>
                </div>
            </div>
        </div><!-- bottom bar -->
    </div>

    <script>
        const logOut = async () => {
            const response = await fetch('http://localhost:3000/api/auth/logout', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            });
            const json = await response.json();
            if (json.success) {
                window.location.replace("http://localhost:3000/");
            }
        }

        const fetchdetails = async () => {
            const response = await fetch('http://localhost:3000/api/auth/getuser', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            });
            const json = await response.json();

            let name = document.getElementById('name')
            name.innerHTML = json.firstname + ' ' + json.lastname



            const str = (window.location.pathname);
            let result = str.lastIndexOf("/");
            const length = str.length

            const id = (window.location.pathname).slice(result + 1, length)

            const res = await fetch('http://localhost:3000/api/auth/getuser/' + id, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            });
            const userData = await res.json();
            console.log(userData);

            document.title = "Your Sawaal :: " + userData.firstname + " " + userData.lastname;
            let fname = document.getElementById('fname')
            fname.innerHTML = userData.firstname + ' ' + userData.lastname
            let mail = document.getElementById('email')
            mail.innerHTML = userData.email
            let gender = document.getElementById('gender')
            gender.innerHTML = userData.gender
            let occupation = document.getElementById('occupation')
            occupation.innerHTML = userData.occupation
            let interests = document.getElementById('interests')
            if (userData.interests.length != 0) {
                interests.innerHTML = userData.interests
            }
            else {
                interests.innerHTML = 'None'
            }
            let education = document.getElementById('education')
            education.innerHTML = userData.education
            let workExperience = document.getElementById('workExperience')
            workExperience.innerHTML = userData.workExperience
            let location = document.getElementById('location')
            location.innerHTML = userData.location
            let country = document.getElementById('country')
            if (userData.country) {
                country.innerHTML = userData.country
            }
            else {
                country.innerHTML = 'Null'
            }
            let about = document.getElementById('about')
            if (userData.about) {
                about.innerHTML = userData.about
            }
            else {
                about.innerHTML = 'Null'
            }

            let hobbies = document.getElementById('hobbies')
            hobbies.innerHTML = userData.hobbies

            let dob = document.getElementById('dob')
            if (userData.dob) {
                const dobDate = new Date(userData.dob);
                dob.innerHTML = dobDate.toLocaleString('default', { month: 'short' }) + ", " + dobDate.getDate() + " " + dobDate.getFullYear()
            }
            else {
                dob.innerHTML = "Null"
            }

            let joined = document.getElementById('joined')
            const date = new Date(userData.joined);
            joined.innerHTML = date.toDateString()

            let followers = document.getElementById('followers')
            followers.innerHTML = userData.followers.length

            let following = document.getElementById('following')
            following.innerHTML = userData.following.length

            let socialmedia = document.getElementById('socialmedia')
            let html = ''
            if (userData.socialNetworks.facebook) {
                html += `<li><a class="facebook" href="${userData.socialNetworks.facebook}" target="_blank"><i class="fa fa-facebook"></i></a></li>`
            }
            if (userData.socialNetworks.instagram) {
                html += `<li><a class="instagram" href="${userData.socialNetworks.instagram}" target="_blank"><i class="fa fa-instagram"></i></a></li>`
            }
            if (userData.socialNetworks.linkedin) {
                html += `<li><a class="linkedin" href="${userData.socialNetworks.linkedin}" target="_blank"><i class="fa fa-linkedin"></i></a></li>`
            }
            if (userData.socialNetworks.youtube) {
                html += `<li><a class="youtube" href="${userData.socialNetworks.youtube}" target="_blank"><i class="fa fa-youtube"></i></a></li> `
            }
            if (html == '') {
                html = 'None'
            }
            socialmedia.innerHTML = html


            let followDiv = document.getElementById('follow')
            if (userData._id != json._id) {
                if ((json.following).includes(userData._id)) {
                    followDiv.innerHTML = `<li><a href="#" title="UnFollow" data-toggle="tooltip"><i
                                                            class="fa fa-star" onclick="unfollowUser('${userData._id}')"></i></a></li>`
                }
                else {
                    followDiv.innerHTML = `<li><a href="#" title="Follow" data-toggle="tooltip"><i
                                                            class="fa fa-user-plus" onclick="followUser('${userData._id}')"></i></a></li>`
                }
            }
            else {
                followDiv.classList.remove("profile-controls")
            }
        }
        fetchdetails()

        const followUser = async (id) => {
            const response = await fetch('http://localhost:3000/api/user/follow/' + id, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            });
            const json = await response.json();
            if (json.success) {
                location.reload();
            }
        }

        const unfollowUser = async (id) => {
            const response = await fetch('http://localhost:3000/api/user/unfollow/' + id, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            });
            const json = await response.json();

            if (json.success) {
                location.reload();
            }
        }

        const handleSearch = async (e) => {
            e.preventDefault()
            const searchinput = document.getElementById('searchinput').value
            console.log(searchinput);
            let url = 'http://localhost:3000/api/auth/getuser/name/' + searchinput
            const user = await fetch(url, {
                method: 'GET'
            })
            const users = await user.json()
            if (users) {
                localStorage.setItem('searchResuls', JSON.stringify(users))
                console.log(users);
                window.location.replace("http://localhost:3000/users");
            }
        }
    </script>

    <script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script src="/js/main.min.js"></script>
    <script src="/js/script.js"></script>

</body>

</html>